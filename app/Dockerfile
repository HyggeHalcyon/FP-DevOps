FROM golang:1.23-alpine

WORKDIR /app

RUN go install github.com/air-verse/air@latest

COPY . .

RUN go mod tidy

ARG ENV
ARG DB_HOST
ARG DB_USER
ARG DB_PASS
ARG DB_NAME
ARG DB_PORT
ARG JWT_SECRET

ENV ENV=${ENV:-development}
ENV DB_HOST=${DB_HOST:-postgres}
ENV DB_USER=${DB_USER:-pso}
ENV DB_PASS=${DB_PASS:-pso}
ENV DB_NAME=${DB_NAME:-pso}
ENV DB_PORT=${DB_PORT:-5432}
ENV JWT_SECRET=${JWT_SECRET:-30783fdadf14a73cd89c937b28ca701b7b91cbc1e9aa997d4431b1db33c41acb65678d050919796f73085d26969be155ef4ccf25fa0ad9e0b14525866f888e4e73a58771ac883985e3fc0b85ce70676db2a25cec3a42ed2cefaecf23b1e969acd19bd5a1d2ce35b1af2f5b742d92b3330a21b1d5b701d7e131d9ce2646e48821741e8a16308f5e13ee2b62e1a263b10508ce8bad1e70733a64ba76c321750eeb9f1f8120bc3be1c66c58da352d1ed49d02bd13b59b0fc2a03e4d9f09ee093a1fc85d09899fce09f8032178dbf44a883836657ada35a9396407ea6f626c56b7c5e54cc2caef264049f565d087216260b44c0f2d45dedb33500986a122962bc8ce}

CMD ["air"]